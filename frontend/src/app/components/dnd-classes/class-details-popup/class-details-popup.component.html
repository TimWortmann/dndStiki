<div mat-dialog-content class="dialog-content">
    <h1 mat-dialog-title>Class Details ({{dndClass.name}})</h1>
    
    <div class="infos">
        <div>
            <h2> Basic Infos </h2>
             <div class="flex" *ngIf="dndClass.hitDice">
                 <h3>Hit Dice:</h3>
                 <p>{{dndClass.hitDice}}</p>
            </div>

            <div class="flex" *ngIf="dndClass.spellAbility">
                <h3>Spell Ability:</h3>
                <p>{{dndClass.spellAbility}}</p>
            </div>
            
            <div class="flex" *ngIf="dndClass.wealth">
                <h3>Wealth:</h3>
                <p>{{dndClass.wealth}}</p>
            </div>

             <div class="flex" *ngIf="dndClass.numberOfSkillProficiencies">
                 <h3>Number of Skill Proficiencies:</h3>
                 <p>{{dndClass.numberOfSkillProficiencies}}</p>
             </div>
        </div>

        <p></p>

        <div>  
            <h2>Possible Proficiencies </h2>
            <div class="flex" *ngIf="dndClass.savingThrowProficiencies[0] !== 'none'">
                 <h3>Saving Throws:</h3>
                 <p>{{getFancyListString(dndClass.savingThrowProficiencies)}}</p>
             </div>
             <div class="flex" *ngIf="dndClass.skillProficiencies[0] !== 'none'">
                 <h3>Skills:</h3>
                 <p>{{getFancyListString(dndClass.skillProficiencies)}}</p>
             </div>
             <div class="flex" *ngIf="dndClass.weaponProficiencies[0] !== 'none'">
                 <h3>Weapons:</h3>
                 <p>{{getFancyListString(dndClass.weaponProficiencies)}}</p>
             </div>
             <div class="flex" *ngIf="dndClass.armorProficiencies[0] !== 'none'">
                 <h3>Armor:</h3>
                 <p>{{getFancyListString(dndClass.armorProficiencies)}}</p>
             </div>
            <div class="flex" *ngIf="dndClass.toolProficiencies[0] !== 'none'">
                <h3>Tools:</h3>
                <p>{{getFancyListString(dndClass.toolProficiencies)}}</p>
             </div>
        </div>

        <p *ngIf="dndClass.traits && dndClass.traits.length > 0"></p>

        <div *ngIf="dndClass.traits && dndClass.traits.length > 0">
             <h2> Traits </h2>
             <mat-accordion>
                <mat-expansion-panel *ngFor="let trait of dndClass.traits">
                <mat-expansion-panel-header>
                    <mat-panel-title>{{ trait.name }}</mat-panel-title>
                </mat-expansion-panel-header>
                <div class="text">{{ trait.text }}</div>
           </mat-expansion-panel>
       </mat-accordion>
            </div>

        <p></p>

        <div>
            <h2> Levels </h2>
            <mat-form-field style="width: 500px;">
                <mat-label>Subclass</mat-label>
                <mat-select required [(ngModel)]="selectedSubclass"  (selectionChange)="changeSubclass()">
                <ng-container *ngFor="let subclass of dndClass.subclasses"> 
                    <mat-option [value]="subclass"> {{subclass}} </mat-option>
                </ng-container>
                </mat-select>
            </mat-form-field>
            <mat-accordion>
                <mat-expansion-panel *ngFor="let classLevel of dndClass.classLevels">
                    <mat-expansion-panel-header>
                        <mat-panel-title *ngIf="classLevel.scoreImprovement == undefined || classLevel.scoreImprovement == false">Level {{ classLevel.level}} </mat-panel-title>
                        <mat-panel-title *ngIf="classLevel.scoreImprovement == true">Level {{ classLevel.level}} (Score Improvement) </mat-panel-title>
                    </mat-expansion-panel-header>
                    <ng-container *ngTemplateOutlet="classLevelContent; context: { $implicit: classLevel }"></ng-container>
                </mat-expansion-panel>
            </mat-accordion>
        </div>
    </div>

    <p></p>
</div>

<div mat-dialog-actions class="dialog-actions">
    <button mat-flat-button color="primary" (click)="close()">Close</button>
</div>

<ng-template #classLevelContent let-classLevel>
    <div *ngIf="classLevel.spellSlots && classLevel.spellSlots != '0,0,0,0,0,0,0,0,0,0,'" class="spellSlotsSegment">
        <h3>Spell Slots</h3>
        <ng-container *ngTemplateOutlet="spellSlotTable; context: { $implicit: classLevel.spellSlots }"></ng-container>
    </div>

     <p></p>

    <mat-accordion>
        <ng-container *ngFor="let feature of classLevel.features">
            <ng-container *ngTemplateOutlet="featureExpansionPanel; context: { $implicit: feature }"></ng-container>
        </ng-container>
    </mat-accordion>

    <p></p>

    <mat-accordion>
        <ng-container *ngFor="let counter of classLevel.counters">
            <ng-container *ngTemplateOutlet="counterExpansionPanel; context: { $implicit: counter }"></ng-container>
        </ng-container>
    </mat-accordion>
</ng-template>

<ng-template #featureExpansionPanel let-feature>
    <mat-expansion-panel *ngIf="isFeatureVisible(feature.name)">
        <mat-expansion-panel-header>
            <mat-panel-title>Feature {{ feature.name }} </mat-panel-title>
        </mat-expansion-panel-header>
        <div class="text"> {{feature.text}} </div>
    </mat-expansion-panel>
</ng-template>

<ng-template #counterExpansionPanel let-counter>
    <mat-expansion-panel>
        <mat-expansion-panel-header>
            <mat-panel-title>Reset Info {{ counter.name }} </mat-panel-title>
        </mat-expansion-panel-header>
        <div *ngIf="counter.reset === 'L'"  class="text"> {{ counter.name }} resets on Long Rest. </div>
        <div *ngIf="counter.reset === 'S'"  class="text"> {{ counter.name }} resets on Short Rest. </div>
        <div *ngIf="counter.reset !== 'L' && counter.reset !== 'S'"  class="text"> {{ counter.name }} resets on {{counter.reset}}. </div>
    </mat-expansion-panel>
</ng-template>

<ng-template #spellSlotTable let-spellSlotsString>
    <table>
        <thead>
            <tr>
                <th *ngFor="let header of getSpellSlotsHeaderArray()">{{ header }}</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td *ngFor="let slot of getSpellSlotsDataArray(spellSlotsString)">{{ slot }}</td>
            </tr>
        </tbody>
    </table>
</ng-template>
